{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Rates of religion by county\"\nauthor: \"Andrew Ba Tran\"\ndate: \"December 21, 2016\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n```{r libraries, message=F, warning=F}\nlibrary(ggplot2)   # devtools::install_github(\"hadley/ggplot2\") only if you want subtitles/captions\nlibrary(foreign)\nlibrary(stringr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(rgeos)\nlibrary(maptools)\nlibrary(ggalt)\nlibrary(ggthemes)\nlibrary(albersusa) # devtools::install_github(\"hrbrmstr/albersusa\")\nlibrary(viridis)\nlibrary(scales)\n```\n\n## Prepping the data\n\n```{r prep, message=F, warning=F}\n\ncounties <- read.spss(\"data/religions_counties.SAV\", \n                      to.data.frame = TRUE)\n\ncounties$CNTYNAME <- as.character(counties$CNTYNAME)\ncounties$CNTYNAME <- sub(\"County\", \"\", counties$CNTYNAME)\ncounties$CNTYNAME <- sub(\"\\\\s+$\", \"\", counties$CNTYNAME)\n\ncounties_rates <- counties[ , grepl( \"RATE\" , names( counties ) ) ]\n\n\ncmap <- fortify(counties_composite(), region=\"fips\")\ncmap$id <- as.numeric(cmap$id)\ncounties[is.na(counties)] <- 0\n```\n\n## Function to generate a map\n\n```{r map_maker}\n\nreligion_map <- function(counties, religion, religion_id) {\n  \n  headline <- ifelse(grepl(\"RATE\", as.character(religion_id)), paste(\"Rate of\", religion, \"followers\"), paste(religion, \"followers\"))\n  legend <- ifelse(grepl(\"RATE\", as.character(religion_id)), paste(religion, \"per 1,000 residents\"), \"Followers\")\n  \n  counties_sub <- counties\n  \n  names(counties_sub)[names(counties_sub) == religion_id] <- 'for_map'\n  \n  gg <- ggplot()\n  gg <- gg + geom_map(data=cmap, map=cmap,\n                      aes(x=long, y=lat,map_id=id),\n                      color=\"#2b2b2b\", size=0.05, fill=NA)\n  gg <- gg + geom_map(data=counties_sub, map=cmap,\n                      aes(fill=for_map, map_id=FIPS),\n                      color=\"#2b2b2b\", size=0.05)\n  gg <- gg + scale_fill_viridis(name=legend)\n  gg <- gg + coord_proj(us_laea_proj)\n  gg <- gg + labs(title=headline,\n                  caption=\"TrendCT.org\\nSOURCE: Association of Religion Data Archives 2010\")\n  gg <- gg + theme_map(base_family=\"Arial Narrow\")\n  gg <- gg + theme(legend.position=c(0.8, 0.25))\n  gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n  gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n  \n  gg\n}\n\n```\n\n```{r evangelicals, fig.width=10, fig.height=6}\n\nreligion_map(counties, \"Evangelicals\", \"EVANRATE\")\n\n```\n\n```{r catholics, fig.width=10, fig.height=6}\n# congregations: CTHCNG\n# adherants: CTHADH\nreligion_map(counties, \"Catholicism\", \"CTHRATE\")\n\n```\n\n\n```{r protestant, fig.width=10, fig.height=6}\n# Mainline protestant\nreligion_map(counties, \"Mainline Protestant\", \"MPRTRATE\")\n\n```\n\n\n```{r episcopal, fig.width=10, fig.height=6}\n\nreligion_map(counties, \"Episcopal\", \"ECRATE\")\n\n```\n\n\n```{r methodist, fig.width=10, fig.height=6}\n# United methodist church\nreligion_map(counties, \"Methodist\", \"UMCRATE\")\n\n```\n\n\n```{r baptist, fig.width=10, fig.height=6}\n# American Baptist\nreligion_map(counties, \"American Baptist\", \"ABCRATE\")\n\n```\n\n```{r southern_baptist, fig.width=10, fig.height=6}\n\nreligion_map(counties, \"Southern Baptist\", \"SBCRATE\")\n\n```\n\n```{r lutheran, fig.width=10, fig.height=6}\n# Evangelical Lutheran Church\nreligion_map(counties, \"Lutheran\", \"ELCARATE\")\n\n```\n\n```{r r_judaism, fig.width=10, fig.height=6}\n\nreligion_map(counties, \"Reform Judaism\", \"RFRMRATE\")\n\n```\n\n```{r c_judaism, fig.width=10, fig.height=6}\n\nreligion_map(counties, \"Conservative Judaism\", \"CJUDRATE\")\n\n```\n\n```{r muslim, fig.width=10, fig.height=6}\n\nreligion_map(counties, \"Muslim\", \"MSLMRATE\")\n\n```\n\n\n```{r greek_orthodox, fig.width=10, fig.height=6}\n\nreligion_map(counties, \"Greek Orthodox\", \"GRKRATE\")\n\n```\n\n\n```{r buddhism, fig.width=10, fig.height=6}\n\nreligion_map(counties, \"Buddhism\", \"BUDMRATE\")\n\n```",
    "created" : 1482328316681.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3715815688",
    "id" : "3015F450",
    "lastKnownWriteTime" : 1482334986,
    "last_content_update" : 1482334986274,
    "path" : "~/Documents/Github/trendct-data/2016/12/religion-in-ct/index.Rmd",
    "project_path" : "index.Rmd",
    "properties" : {
        "last_setup_crc32" : "AFFD2AA5ab7c3115",
        "source_window_id" : "wugaepidxccwr",
        "tempName" : "Untitled3"
    },
    "relative_order" : 11,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}